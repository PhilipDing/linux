webpackJsonp([342],{1655:function(t,o){t.exports={render:function(){var t=this,o=t.$createElement;t._self._c;return t._m(0)},staticRenderFns:[function(){var t=this,o=t.$createElement,i=t._self._c||o;return i("section",[i("p",[i("strong",[t._v("Inotify")]),t._v("一种强大的、细粒度的、异步文件系统监控机制，它满足各种各样的文件监控需要，可以监控文件系统的访问属性、读写属性、权限属性、删除创建、移动等操作，也就是可以监控文件发生的一切变化。。")]),t._v(" "),i("p",[i("strong",[t._v("inotify-tools")]),t._v("是一个C库和一组命令行的工作提供Linux下inotify的简单接口。inotify-tools安装后会得到"),i("code",{pre:!0},[t._v("inotifywait")]),t._v("和"),i("code",{pre:!0},[t._v("inotifywatch")]),t._v("这两条命令：")]),t._v(" "),i("ul",[i("li",[i("strong",[t._v("inotifywait命令")]),t._v("可以用来收集有关文件访问信息，Linux发行版一般没有包括这个命令，需要安装inotify-tools，这个命令还需要将inotify支持编译入Linux内核，好在大多数Linux发行版都在内核中启用了inotify。")]),t._v(" "),i("li",[i("strong",[t._v("inotifywatch命令")]),t._v("用于收集关于被监视的文件系统的统计数据，包括每个 inotify 事件发生多少次。")])]),t._v(" "),i("p",[t._v("开始之前需要检测系统内核是否支持inotify：")]),t._v(" "),i("p",[t._v("使用"),i("code",{pre:!0},[t._v('[uname](#/uname "uname命令") -r')]),t._v("命令检查Linux内核，如果低于2.6.13，就需要重新编译内核加入inotify的支持。")]),t._v(" "),i("p",[t._v("使用"),i("code",{pre:!0},[t._v("ll /proc/sys/fs/inotify")]),t._v("命令，是否有以下三条信息输出，如果没有表示不支持。")]),t._v(" "),i("pre",{pre:!0},[i("code",{attrs:{"v-pre":""}},[t._v("ll /proc/sys/fs/inotify\ntotal 0\n-rw-r--r-- 1 root root 0 Jan  4 15:41 max_queued_events\n-rw-r--r-- 1 root root 0 Jan  4 15:41 max_user_instances\n-rw-r--r-- 1 root root 0 Jan  4 15:41 max_user_watches\n\n")])]),t._v(" "),i("h3",[t._v("安装inotify-tools")]),t._v(" "),i("ul",[i("li",[t._v("inotify-tools项目地址："),i("a",{attrs:{href:"https://github.com/rvoicilas/inotify-tools"}},[t._v("https://github.com/rvoicilas/inotify-tools")])]),t._v(" "),i("li",[t._v("inotify-tools下载地址："),i("a",{attrs:{href:"http://github.com/downloads/rvoicilas/inotify-tools/inotify-tools-3.14.tar.gz"}},[t._v("http://github.com/downloads/rvoicilas/inotify-tools/inotify-tools-3.14.tar.gz")])])]),t._v(" "),i("pre",{pre:!0},[i("code",{attrs:{"v-pre":""}},[t._v('#CentOS release 5.8/64位：\n[tar](#/tar "tar命令") zxvf inotify-tools-3.14.tar.gz\n[cd](#/cd "cd命令") inotify-tools-3.14\n./configure\n[make](#/make "make命令")\nmake [install](#/install "install命令")\n')])]),t._v(" "),i("p",[t._v("其他Linux发行版安装方法可以参见："),i("a",{attrs:{href:"https://github.com/rvoicilas/inotify-tools/wiki#wiki-getting"}},[t._v("https://github.com/rvoicilas/inotify-tools/wiki#wiki-getting")])]),t._v(" "),i("h3",[t._v("inotify相关参数")]),t._v(" "),i("p",[t._v("inotify定义了下列的接口参数，可以用来限制inotify消耗kernel memory的大小。由于这些参数都是内存参数，因此，可以根据应用需求，实时的调节其大小：")]),t._v(" "),i("ul",[i("li",[i("code",{pre:!0},[t._v("/proc/sys/fs/inotify/max_queued_evnets")]),t._v("表示调用inotify_init时分配给inotify instance中可排队的event的数目的最大值，超出这个值的事件被丢弃，但会触发IN_Q_OVERFLOW事件。")]),t._v(" "),i("li",[i("code",{pre:!0},[t._v("/proc/sys/fs/inotify/max_user_instances")]),t._v("表示每一个real user "),i("a",{attrs:{href:"#/id",title:"id命令"}},[t._v("id")]),t._v("可创建的inotify instatnces的数量上限。")]),t._v(" "),i("li",[i("code",{pre:!0},[t._v("/proc/sys/fs/inotify/max_user_watches")]),t._v("表示每个inotify instatnces可监控的最大目录数量。如果监控的文件数目巨大，需要根据情况，适当增加此值的大小。")])]),t._v(" "),i("p",[t._v("根据以上在32位或者64位系统都可以执行：")]),t._v(" "),i("pre",{pre:!0},[i("code",{attrs:{"v-pre":""}},[t._v("[echo](#/echo \"echo命令\") 104857600 > /proc/sys/fs/inotify/max_user_watches\necho 'echo 104857600 > /proc/sys/fs/inotify/max_user_watches' >> /etc/rc.local\n")])]),t._v(" "),i("p",[t._v("如果遇到以下错误：")]),t._v(" "),i("pre",{pre:!0},[i("code",{attrs:{"v-pre":""}},[t._v('inotifywait: error while loading shared libraries: libinotifytools.so.0: cannot open shared object [file](#/file "file命令"): No such file or directory\n')])]),t._v(" "),i("pre",{pre:!0},[i("code",{attrs:{"v-pre":""}},[t._v('**解决方法：**\n32位系统：[ln](#/ln "ln命令") -s /usr/local/lib/libinotifytools.so.0 /usr/lib/libinotifytools.so.0\n64位系统：ln -s /usr/local/lib/libinotifytools.so.0 /usr/lib64/libinotifytools.so.0\n')])]),t._v(" "),i("h3",[t._v("inotifywait命令使用")]),t._v(" "),i("pre",{pre:!0},[i("code",{attrs:{"v-pre":""}},[t._v("#!/bin/bash\n#filename watchdir.sh\npath=$1\n/usr/local/bin/inotifywait -mrq --timefmt '%d/%m/%y/%H:%M' --format '%T %[w](#/w \"w命令\") %f' -e modify,delete,create,attrib $path\n\n执行输出：\n./watchdir.sh /data/wsdata/tools/\n04/01/13/16:34 /data/wsdata/tools/ .j.jsp.swp\n04/01/13/16:34 /data/wsdata/tools/ .j.jsp.swx\n04/01/13/16:34 /data/wsdata/tools/ .j.jsp.swx\n04/01/13/16:34 /data/wsdata/tools/ .j.jsp.swp\n04/01/13/16:34 /data/wsdata/tools/ .j.jsp.swp\n04/01/13/16:34 /data/wsdata/tools/ .j.jsp.swp\n04/01/13/16:34 /data/wsdata/tools/ .j.jsp.swp\n04/01/13/16:34 /data/wsdata/tools/ .j.jsp.swp\n04/01/13/16:35 /data/wsdata/tools/ 4913\n04/01/13/16:35 /data/wsdata/tools/ 4913\n04/01/13/16:35 /data/wsdata/tools/ 4913\n04/01/13/16:35 /data/wsdata/tools/ j.jsp\n04/01/13/16:35 /data/wsdata/tools/ j.jsp\n04/01/13/16:35 /data/wsdata/tools/ j.jsp\n04/01/13/16:35 /data/wsdata/tools/ j.jsp~\n04/01/13/16:35 /data/wsdata/tools/ .j.jsp.swp\n\n")])]),t._v(" "),i("h3",[t._v("inotifywait命令参数")]),t._v(" "),i("ul",[i("li",[i("code",{pre:!0},[t._v("-m")]),t._v("是要持续监视变化。")]),t._v(" "),i("li",[i("code",{pre:!0},[t._v("-r")]),t._v("使用递归形式监视目录。")]),t._v(" "),i("li",[i("code",{pre:!0},[t._v("-q")]),t._v("减少冗余信息，只打印出需要的信息。")]),t._v(" "),i("li",[i("code",{pre:!0},[t._v("-e")]),t._v("指定要监视的事件列表。")]),t._v(" "),i("li",[i("code",{pre:!0},[t._v("--timefmt")]),t._v("是指定时间的输出格式。")]),t._v(" "),i("li",[i("code",{pre:!0},[t._v("--format")]),t._v("指定文件变化的详细信息。")])]),t._v(" "),i("h4",[t._v("可监听的事件")]),t._v(" "),i("table",{staticStyle:{width:"100%"},attrs:{border:"0",height:"193",width:"74"}},[i("tbody",[i("tr",[i("th",[t._v("事件")]),t._v(" "),i("th",[t._v("描述")])]),t._v(" "),i("tr",[i("td",[t._v("access")]),t._v(" "),i("td",[t._v("**访问**，读取文件。")])]),t._v(" "),i("tr",[i("td",[t._v("modify")]),t._v(" "),i("td",[t._v("**修改**，文件内容被修改。")])]),t._v(" "),i("tr",[i("td",[t._v("attrib")]),t._v(" "),i("td",[t._v("**属性**，文件元数据被修改。")])]),t._v(" "),i("tr",[i("td",[t._v("move")]),t._v(" "),i("td",[t._v("**移动**，对文件进行移动操作。")])]),t._v(" "),i("tr",[i("td",[t._v("create")]),t._v(" "),i("td",[t._v("**创建**，生成新文件")])]),t._v(" "),i("tr",[i("td",[t._v("open")]),t._v(" "),i("td",[t._v("**打开**，对文件进行打开操作。")])]),t._v(" "),i("tr",[i("td",[t._v("close")]),t._v(" "),i("td",[t._v("**关闭**，对文件进行关闭操作。")])]),t._v(" "),i("tr",[i("td",[t._v("delete")]),t._v(" "),i("td",[t._v("**删除**，文件被删除。")])])])])])}]}},209:function(t,o,i){t.exports=i(798)},798:function(t,o,i){var s=i(5)(null,i(1655),null,null,null);t.exports=s.exports}});
//# sourceMappingURL=342.35927cd2f3b2c659dcb7.js.map