webpackJsonp([233],{1162:function(e,n){e.exports={render:function(){var e=this,n=e.$createElement;e._self._c;return e._m(0)},staticRenderFns:[function(){var e=this,n=e.$createElement,p=e._self._c||n;return p("section",[p("p",[p("strong",[e._v("ngrep命令")]),e._v("是"),p("a",{attrs:{href:"#/grep",title:"grep命令"}},[e._v("grep")]),e._v("命令的网络版，他力求更多的grep特征，用于搜寻指定的数据包。正由于安装ngrep需用到libpcap库， 所以支持大量的操作系统和网络协议。能识别TCP、UDP和ICMP包，理解bpf的过滤机制。")]),e._v(" "),p("h3",[e._v("安装")]),e._v(" "),p("p",[e._v("ngrep命令的下载地址：http://ngrep.sourceforge.net/，libpcap下载地址：http://www."),p("a",{attrs:{href:"#/tcpdump",title:"tcpdump命令"}},[e._v("tcpdump")]),e._v(".org/。先用"),p("code",{pre:!0},[e._v('[yum](#/yum "yum命令") [install](#/install "install命令") libpcap')]),e._v("完全安装libpcap，注意有时候用libpcap安装包安装的不完整会影响ngrep的使用。")]),e._v(" "),p("p",[e._v("如果yum无法安装就用以下步骤安装libpcap：")]),e._v(" "),p("pre",{pre:!0},[p("code",{attrs:{"v-pre":""}},[e._v('[wget](#/wget "wget命令") http://www.tcpdump.org/release/libpcap-1.3.0.[tar](#/tar "tar命令").gz\ntar -zxf libpcap-1.3.0.tar.gz\n[cd](#/cd "cd命令") libpcap-1.3.0\n./configure\n[make](#/make "make命令") && make install\n')])]),e._v(" "),p("p",[e._v("ngrep的安装就是 configure/make/make install 三部曲。")]),e._v(" "),p("p",[e._v("注：configure时是遇到 please wipe out all unused pcap installations，添加以下选项：")]),e._v(" "),p("pre",{pre:!0},[p("code",{attrs:{"v-pre":""}},[e._v("./configure --with-pcap-includes=/usr/local/include/pcap\n")])]),e._v(" "),p("p",[e._v("在安装后输入ngrep来验证下安装是否成功。")]),e._v(" "),p("h3",[e._v("语法")]),e._v(" "),p("pre",{pre:!0},[p("code",{attrs:{"v-pre":""}},[e._v('ngrep <-LhNXViwqpevxlDtTRM> <-IO pcap_dump> <-n num> <-d dev> <-A num>\n<-s snaplen> <-S limitlen> <-[w](#/w "w命令") normal|byline|single|none> <-c cols>\n<-P char> <-F [file](#/file "file命令")> <match expression> <bpf filter>\n')])]),e._v(" "),p("h3",[e._v("选项")]),e._v(" "),p("pre",{pre:!0},[p("code",{attrs:{"v-pre":""}},[e._v('-e ：显示空数据包\n-i ：忽略大小写\n-v ：反转匹配\n-R ：don\'t do privilege revocation logic\n-x ：以16进制格式显示\n-X ：以16进制格式匹配\n-w ：整字匹配\n-p ：不使用混杂模式\n-l ：make stdout line buffered\n-D ：replay pcap_dumps with their recorded [time](#/time "time命令") intervals\n-t ：在每个匹配的包之前显示时间戳\n-T ：显示上一个匹配的数据包之间的时间间隔\n-M ：仅进行单行匹配\n-I ：从文件中读取数据进行匹配\n-O ：将匹配的数据保存到文件\n-n ：仅捕获指定数目的数据包进行查看\n-A ：匹配到数据包后[dump](#/dump "dump命令")随后的指定数目的数据包\n-s ：[set](#/set "set命令") the bpf caplen\n-S ：set the limitlen on matched packets\n-W ：设置显示格式byline将解析包中的换行符\n-c ：强制显示列的宽度\n-P ：set the non-printable display char to what is specified\n-F ：使用文件中定义的bpf(Berkeley Packet Filter)\n-N ：显示由IANA定义的子协议号\n-d ：使用哪个网卡，可以用-L选项查询\n-L ：查询网卡接口\n')])]),e._v(" "),p("h3",[e._v("实例")]),e._v(" "),p("p",[e._v("捕捉cloudian：18080端口的request和response，"),p("code",{pre:!0},[e._v("-W byline")]),e._v("用来解析包中的换行符，否则包里的所有数据都是连续的，可读性差。"),p("code",{pre:!0},[e._v("-d lo")]),e._v("是监听本地网卡：")]),e._v(" "),p("pre",{pre:!0},[p("code",{attrs:{"v-pre":""}},[e._v("ngrep -W byline -d lo port 18080\n")])]),e._v(" "),p("p",[e._v("捕捉amazon：80端口的request和response。"),p("code",{pre:!0},[e._v("-d eth0是")]),e._v("用来监听对外的网卡：")]),e._v(" "),p("pre",{pre:!0},[p("code",{attrs:{"v-pre":""}},[e._v("ngrep -W byline -d eth0 port 80\n")])]),e._v(" "),p("p",[e._v("可以用"),p("code",{pre:!0},[e._v("-d any")]),e._v("来捕捉所有的包：")]),e._v(" "),p("pre",{pre:!0},[p("code",{attrs:{"v-pre":""}},[e._v("ngrep '[a-zA-Z]' -t -W byline -d any tcp port 18080\n")])]),e._v(" "),p("p",[e._v("捕获字符串"),p("code",{pre:!0},[e._v(".flv")]),e._v("，比如要查看在Web Flash 视频中的.flv文件的下载地址：")]),e._v(" "),p("pre",{pre:!0},[p("code",{attrs:{"v-pre":""}},[e._v("ngrep -d3 -N -q \\.flv\ninterface: \\Device\\TNT_40_1_{670F6B50-0A13-4BAB-9D9E-994A833F5BA9} (10.132.0.0/2\n55.255.192.0)\nmatch: \\.flv\n")])]),e._v(" "),p("p",[e._v("打开一个视频页面：")]),e._v(" "),p("pre",{pre:!0},[p("code",{attrs:{"v-pre":""}},[e._v('T(6) 10.132.34.23:24860 -> 61.142.208.154:80 [AP]\nGET /f59.c31.56.com/flvdownload/12/19/ggyg7741@56.com_56flv_zhajm_119556973\n97.flv HTTP/1.1..[accept](#/accept "accept命令"): */*..Referer: http://www.56.com/flashApp/v_player_\nsite.swf..x-flash-version: 9,0,45,0..UA-CPU: x86..Accept-Encoding: [gzip](#/gzip "gzip命令"), de\nflate..User-Agent: Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1; .NET\nCLR 2.0.50727; .NET CLR 3.0.04506.30)..[host](#/host "host命令"): f59.r.56.com..Connection: Keep\n-Alive..Cookie: whistoryview=23423759-23635627-23423344-23171935-23058374-2\n3081156-23207350-22395727-; geoip=............; wl_all_s=y....\n')])]),e._v(" "),p("p",[e._v("OK。地址已经找到了,就是http://f59.c31.56.com/flvdownload/12/19/ggyg7741@56.com_56flv_zhajm_11955697397.flv")]),e._v(" "),p("p",[e._v("加个"),p("code",{pre:!0},[e._v("-W byline")]),e._v("参数后,将解析包中的换行符：")]),e._v(" "),p("pre",{pre:!0},[p("code",{attrs:{"v-pre":""}},[e._v('T(6) 2007/11/25 15:56:12.192619 10.132.34.23:26365 -> 59.151.21.101:80 [AP]\nGET /aa.flv HTTP/1.1.\nAccept: */*.\nAccept-Language: zh-cn.\nUA-CPU: x86.\nAccept-Encoding: gzip, deflate.\nUser-Agent: Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1; .NET CLR 2.0.5072\n7; .NET CLR 3.0.04506.30).\nHost: www.google.cn.\nConnection: Keep-Alive.\nCookie: PREF=[id](#/id "id命令")=a0b2932c336477e9:TB=4:NW=1:TM=1187877372:LM=1187956074:S=Y1Fzndp\nrT3vFo7ac; SID=DQAAAHcAAABJCEXeOVLHu2rIfb5BfKP3GG9PbhJDEkXsLTV8y0f_lvSd2Y46Q0FPt\n83CnEs9rxA1xBDM9mLR8-ckWeScyOQA8PyYnX5u5OjFvjfRbDg_FDZfwxhRzqS9KPZv26pjnsUxs0FDM\n1xpJ5AgDn38pXtlCdkksJ0-cbiIWoA61oHWMg; NID=7=AvJxn5B6YOLLxoYz4LLzhIbNsQUQiulRS6U\nJGxdBniQBmXm99y7L-NBNORN82N3unmZSGHFPfePVHnLK2MjYjglyXZhU9x7ETXNBnY3NurNijHDhJ7K\nyi7E53UBOcv4V.\n')])])])}]}},321:function(e,n,p){e.exports=p(909)},909:function(e,n,p){var t=p(5)(null,p(1162),null,null,null);e.exports=t.exports}});
//# sourceMappingURL=233.44f4793a316c844d421b.js.map